-- Create "environments" table
CREATE TABLE "environments" ("id" uuid NOT NULL DEFAULT generate_uuidv7(), "organization_id" text NOT NULL, "project_id" uuid NOT NULL, "name" text NOT NULL, "slug" text NOT NULL, "created_at" timestamptz NOT NULL DEFAULT clock_timestamp(), "updated_at" timestamptz NOT NULL DEFAULT clock_timestamp(), "deleted_at" timestamptz NULL, "deleted" boolean NOT NULL GENERATED ALWAYS AS (deleted_at IS NOT NULL) STORED, PRIMARY KEY ("id"), CONSTRAINT "environments_project_id_slug_key" UNIQUE ("project_id", "slug"), CONSTRAINT "environments_project_id_fkey" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") ON UPDATE NO ACTION ON DELETE SET NULL);
-- Create "environment_entries" table
CREATE TABLE "environment_entries" ("name" text NOT NULL, "value" text NOT NULL, "environment_id" uuid NOT NULL, "created_at" timestamptz NOT NULL DEFAULT clock_timestamp(), "updated_at" timestamptz NOT NULL DEFAULT clock_timestamp(), "deleted_at" timestamptz NULL, "deleted" boolean NOT NULL GENERATED ALWAYS AS (deleted_at IS NOT NULL) STORED, CONSTRAINT "environments_entries_pkey" PRIMARY KEY ("environment_id", "name"), CONSTRAINT "environments_entries_environment_id_fkey" FOREIGN KEY ("environment_id") REFERENCES "environments" ("id") ON UPDATE NO ACTION ON DELETE CASCADE);
