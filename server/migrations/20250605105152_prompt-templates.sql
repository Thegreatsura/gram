-- Create "prompt_templates" table
CREATE TABLE "prompt_templates" ("id" uuid NOT NULL DEFAULT generate_uuidv7(), "project_id" uuid NOT NULL, "history_id" uuid NOT NULL, "predecessor_id" uuid NULL, "name" text NOT NULL, "description" text NULL, "arguments" jsonb NULL, "prompt" text NOT NULL, "engine" text NULL, "kind" text NULL, "tools_hint" text[] NULL DEFAULT ARRAY[]::text[], "created_at" timestamptz NOT NULL DEFAULT clock_timestamp(), "updated_at" timestamptz NOT NULL DEFAULT clock_timestamp(), "deleted_at" timestamptz NULL, "deleted" boolean NOT NULL GENERATED ALWAYS AS (deleted_at IS NOT NULL) STORED, PRIMARY KEY ("id"), CONSTRAINT "prompt_templates_predecessor_id_fkey" FOREIGN KEY ("predecessor_id") REFERENCES "prompt_templates" ("id") ON UPDATE NO ACTION ON DELETE SET NULL, CONSTRAINT "prompt_templates_project_id_fkey" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") ON UPDATE NO ACTION ON DELETE CASCADE, CONSTRAINT "prompt_templates_description_check" CHECK ((description <> ''::text) AND (char_length(description) <= 100)), CONSTRAINT "prompt_templates_engine_check" CHECK (engine = 'mustache'::text), CONSTRAINT "prompt_templates_kind_check" CHECK (kind = ANY (ARRAY['prompt'::text, 'higher_order_tool'::text])), CONSTRAINT "prompt_templates_name_check" CHECK ((name <> ''::text) AND (char_length(name) <= 40)), CONSTRAINT "prompt_templates_tools_hint_check" CHECK (array_length(tools_hint, 1) <= 20));
-- Create index "prompt_templates_project_id_idx" to table: "prompt_templates"
CREATE INDEX "prompt_templates_project_id_idx" ON "prompt_templates" ("project_id", "history_id") WHERE (deleted IS FALSE);
-- Create index "prompt_templates_project_id_name_key" to table: "prompt_templates"
CREATE UNIQUE INDEX "prompt_templates_project_id_name_key" ON "prompt_templates" ("project_id", "name", "predecessor_id") WHERE (deleted IS FALSE);
