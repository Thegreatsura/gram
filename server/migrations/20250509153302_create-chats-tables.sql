-- Create "chats" table
CREATE TABLE "chats" ("id" uuid NOT NULL DEFAULT generate_uuidv7(), "project_id" uuid NOT NULL, "organization_id" text NOT NULL, "user_id" text NULL, "title" text NULL, "created_at" timestamptz NOT NULL DEFAULT clock_timestamp(), "updated_at" timestamptz NOT NULL DEFAULT clock_timestamp(), "deleted_at" timestamptz NULL, "deleted" boolean NOT NULL GENERATED ALWAYS AS (deleted_at IS NOT NULL) STORED, PRIMARY KEY ("id"), CONSTRAINT "chats_project_id_fkey" FOREIGN KEY ("project_id") REFERENCES "projects" ("id") ON UPDATE NO ACTION ON DELETE CASCADE);
-- Create "chat_messages" table
CREATE TABLE "chat_messages" ("id" uuid NOT NULL DEFAULT generate_uuidv7(), "chat_id" uuid NOT NULL, "role" text NOT NULL, "content" text NOT NULL, "model" text NULL, "message_id" text NULL, "tool_call_id" text NULL, "user_id" text NULL, "finish_reason" text NULL, "tool_calls" jsonb NULL, "created_at" timestamptz NOT NULL DEFAULT clock_timestamp(), PRIMARY KEY ("id"), CONSTRAINT "chat_messages_chat_id_fkey" FOREIGN KEY ("chat_id") REFERENCES "chats" ("id") ON UPDATE NO ACTION ON DELETE CASCADE, CONSTRAINT "chat_messages_role_check" CHECK (role = ANY (ARRAY['user'::text, 'assistant'::text, 'system'::text, 'tool'::text])));
-- Create index "chat_messages_chat_id_idx" to table: "chat_messages"
CREATE INDEX "chat_messages_chat_id_idx" ON "chat_messages" ("chat_id");
