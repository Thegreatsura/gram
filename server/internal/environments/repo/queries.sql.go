// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.28.0
// source: queries.sql

package repo

import (
	"context"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const createEnvironment = `-- name: CreateEnvironment :one
INSERT INTO environments (
    organization_id,
    project_id,
    name,
    slug
) VALUES (
    $1,
    $2,
    $3,
    $4
) RETURNING id, organization_id, project_id, name, slug, created_at, updated_at, deleted_at, deleted
`

type CreateEnvironmentParams struct {
	OrganizationID string
	ProjectID      uuid.UUID
	Name           string
	Slug           string
}

func (q *Queries) CreateEnvironment(ctx context.Context, arg CreateEnvironmentParams) (Environment, error) {
	row := q.db.QueryRow(ctx, createEnvironment,
		arg.OrganizationID,
		arg.ProjectID,
		arg.Name,
		arg.Slug,
	)
	var i Environment
	err := row.Scan(
		&i.ID,
		&i.OrganizationID,
		&i.ProjectID,
		&i.Name,
		&i.Slug,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
		&i.Deleted,
	)
	return i, err
}

const createEnvironmentEntries = `-- name: CreateEnvironmentEntries :many
INSERT INTO environment_entries (
    environment_id,
    name,
    value
) 
/*
 Parameters:
 - environment_id: uuid
 - names: text[]
 - values: text[]
*/
VALUES (
    $1::uuid,
    unnest($2::text[]),
    unnest($3::text[])
)
RETURNING name, value, environment_id, created_at, updated_at, deleted_at, deleted
`

type CreateEnvironmentEntriesParams struct {
	EnvironmentID uuid.UUID
	Names         []string
	Values        []string
}

func (q *Queries) CreateEnvironmentEntries(ctx context.Context, arg CreateEnvironmentEntriesParams) ([]EnvironmentEntry, error) {
	rows, err := q.db.Query(ctx, createEnvironmentEntries, arg.EnvironmentID, arg.Names, arg.Values)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []EnvironmentEntry
	for rows.Next() {
		var i EnvironmentEntry
		if err := rows.Scan(
			&i.Name,
			&i.Value,
			&i.EnvironmentID,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.DeletedAt,
			&i.Deleted,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const deleteEnvironment = `-- name: DeleteEnvironment :exec
UPDATE environments
SET deleted_at = now()
WHERE slug = $1 AND project_id = $2 AND deleted_at IS NULL
`

type DeleteEnvironmentParams struct {
	Slug      string
	ProjectID uuid.UUID
}

func (q *Queries) DeleteEnvironment(ctx context.Context, arg DeleteEnvironmentParams) error {
	_, err := q.db.Exec(ctx, deleteEnvironment, arg.Slug, arg.ProjectID)
	return err
}

const deleteEnvironmentEntry = `-- name: DeleteEnvironmentEntry :exec
UPDATE environment_entries
SET deleted_at = now()
WHERE environment_id = $1 AND name = $2 AND deleted_at IS NULL
`

type DeleteEnvironmentEntryParams struct {
	EnvironmentID uuid.UUID
	Name          string
}

func (q *Queries) DeleteEnvironmentEntry(ctx context.Context, arg DeleteEnvironmentEntryParams) error {
	_, err := q.db.Exec(ctx, deleteEnvironmentEntry, arg.EnvironmentID, arg.Name)
	return err
}

const getEnvironment = `-- name: GetEnvironment :one
SELECT e.id, e.organization_id, e.project_id, e.name, e.slug, e.created_at, e.updated_at, e.deleted_at, e.deleted
FROM environments e
WHERE e.slug = $1 AND e.project_id = $2 AND e.deleted_at IS NULL
`

type GetEnvironmentParams struct {
	Slug      string
	ProjectID uuid.UUID
}

func (q *Queries) GetEnvironment(ctx context.Context, arg GetEnvironmentParams) (Environment, error) {
	row := q.db.QueryRow(ctx, getEnvironment, arg.Slug, arg.ProjectID)
	var i Environment
	err := row.Scan(
		&i.ID,
		&i.OrganizationID,
		&i.ProjectID,
		&i.Name,
		&i.Slug,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
		&i.Deleted,
	)
	return i, err
}

const listEnvironmentEntries = `-- name: ListEnvironmentEntries :many
SELECT 
    ee.name as name,
    ee.value as value,
    ee.created_at as created_at,
    ee.updated_at as updated_at,
    ee.deleted_at as deleted_at
FROM environment_entries ee
WHERE ee.environment_id = $1 AND ee.deleted_at IS NULL
ORDER BY ee.name ASC
`

type ListEnvironmentEntriesRow struct {
	Name      string
	Value     string
	CreatedAt pgtype.Timestamptz
	UpdatedAt pgtype.Timestamptz
	DeletedAt pgtype.Timestamptz
}

func (q *Queries) ListEnvironmentEntries(ctx context.Context, environmentID uuid.UUID) ([]ListEnvironmentEntriesRow, error) {
	rows, err := q.db.Query(ctx, listEnvironmentEntries, environmentID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []ListEnvironmentEntriesRow
	for rows.Next() {
		var i ListEnvironmentEntriesRow
		if err := rows.Scan(
			&i.Name,
			&i.Value,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.DeletedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listEnvironments = `-- name: ListEnvironments :many
SELECT e.id, e.organization_id, e.project_id, e.name, e.slug, e.created_at, e.updated_at, e.deleted_at, e.deleted
FROM environments e
WHERE e.project_id = $1 AND e.deleted_at IS NULL
ORDER BY e.created_at DESC
`

func (q *Queries) ListEnvironments(ctx context.Context, projectID uuid.UUID) ([]Environment, error) {
	rows, err := q.db.Query(ctx, listEnvironments, projectID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Environment
	for rows.Next() {
		var i Environment
		if err := rows.Scan(
			&i.ID,
			&i.OrganizationID,
			&i.ProjectID,
			&i.Name,
			&i.Slug,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.DeletedAt,
			&i.Deleted,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateEnvironmentEntry = `-- name: UpdateEnvironmentEntry :one
UPDATE environment_entries
SET 
    value = $3,
    updated_at = now()
WHERE environment_id = $1 AND name = $2 AND deleted_at IS NULL
RETURNING name, value, environment_id, created_at, updated_at, deleted_at, deleted
`

type UpdateEnvironmentEntryParams struct {
	EnvironmentID uuid.UUID
	Name          string
	Value         string
}

func (q *Queries) UpdateEnvironmentEntry(ctx context.Context, arg UpdateEnvironmentEntryParams) (EnvironmentEntry, error) {
	row := q.db.QueryRow(ctx, updateEnvironmentEntry, arg.EnvironmentID, arg.Name, arg.Value)
	var i EnvironmentEntry
	err := row.Scan(
		&i.Name,
		&i.Value,
		&i.EnvironmentID,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
		&i.Deleted,
	)
	return i, err
}
