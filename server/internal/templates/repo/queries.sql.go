// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: queries.sql

package repo

import (
	"context"

	"github.com/google/uuid"
	"github.com/jackc/pgx/v5/pgtype"
)

const createTemplate = `-- name: CreateTemplate :one
INSERT INTO prompt_templates (
  project_id,
  history_id,
  predecessor_id,
  name,
  prompt,
  description,
  arguments,
  engine,
  kind,
  tools_hint
) VALUES (
  $1,
  $2,
  $3,
  $4,
  $5,
  $6,
  $7,
  $8,
  $9,
  $10
)
RETURNING id
`

type CreateTemplateParams struct {
	ProjectID     uuid.UUID
	HistoryID     uuid.UUID
	PredecessorID uuid.NullUUID
	Name          string
	Prompt        string
	Description   pgtype.Text
	Arguments     []byte
	Engine        pgtype.Text
	Kind          pgtype.Text
	ToolsHint     []string
}

func (q *Queries) CreateTemplate(ctx context.Context, arg CreateTemplateParams) (uuid.UUID, error) {
	row := q.db.QueryRow(ctx, createTemplate,
		arg.ProjectID,
		arg.HistoryID,
		arg.PredecessorID,
		arg.Name,
		arg.Prompt,
		arg.Description,
		arg.Arguments,
		arg.Engine,
		arg.Kind,
		arg.ToolsHint,
	)
	var id uuid.UUID
	err := row.Scan(&id)
	return id, err
}

const deleteTemplateByID = `-- name: DeleteTemplateByID :exec
UPDATE prompt_templates
SET deleted_at = clock_timestamp()
WHERE project_id = $1
  AND id = $2
`

type DeleteTemplateByIDParams struct {
	ProjectID uuid.UUID
	ID        uuid.UUID
}

func (q *Queries) DeleteTemplateByID(ctx context.Context, arg DeleteTemplateByIDParams) error {
	_, err := q.db.Exec(ctx, deleteTemplateByID, arg.ProjectID, arg.ID)
	return err
}

const deleteTemplateByName = `-- name: DeleteTemplateByName :exec
UPDATE prompt_templates
SET deleted_at = clock_timestamp()
WHERE project_id = $1
  AND name = $2
`

type DeleteTemplateByNameParams struct {
	ProjectID uuid.UUID
	Name      string
}

func (q *Queries) DeleteTemplateByName(ctx context.Context, arg DeleteTemplateByNameParams) error {
	_, err := q.db.Exec(ctx, deleteTemplateByName, arg.ProjectID, arg.Name)
	return err
}

const getTemplateByID = `-- name: GetTemplateByID :one
SELECT id, project_id, history_id, predecessor_id, name, description, arguments, prompt, engine, kind, tools_hint, created_at, updated_at, deleted_at, deleted
FROM prompt_templates pt
WHERE
  pt.project_id = $1
  AND pt.id = $2
  AND pt.deleted IS FALSE
LIMIT 1
`

type GetTemplateByIDParams struct {
	ProjectID uuid.UUID
	ID        uuid.UUID
}

func (q *Queries) GetTemplateByID(ctx context.Context, arg GetTemplateByIDParams) (PromptTemplate, error) {
	row := q.db.QueryRow(ctx, getTemplateByID, arg.ProjectID, arg.ID)
	var i PromptTemplate
	err := row.Scan(
		&i.ID,
		&i.ProjectID,
		&i.HistoryID,
		&i.PredecessorID,
		&i.Name,
		&i.Description,
		&i.Arguments,
		&i.Prompt,
		&i.Engine,
		&i.Kind,
		&i.ToolsHint,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
		&i.Deleted,
	)
	return i, err
}

const getTemplateByName = `-- name: GetTemplateByName :one
SELECT id, project_id, history_id, predecessor_id, name, description, arguments, prompt, engine, kind, tools_hint, created_at, updated_at, deleted_at, deleted
FROM prompt_templates pt
WHERE
  pt.project_id = $1
  AND pt.name = $2
  AND pt.deleted IS FALSE
LIMIT 1
`

type GetTemplateByNameParams struct {
	ProjectID uuid.UUID
	Name      string
}

func (q *Queries) GetTemplateByName(ctx context.Context, arg GetTemplateByNameParams) (PromptTemplate, error) {
	row := q.db.QueryRow(ctx, getTemplateByName, arg.ProjectID, arg.Name)
	var i PromptTemplate
	err := row.Scan(
		&i.ID,
		&i.ProjectID,
		&i.HistoryID,
		&i.PredecessorID,
		&i.Name,
		&i.Description,
		&i.Arguments,
		&i.Prompt,
		&i.Engine,
		&i.Kind,
		&i.ToolsHint,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
		&i.Deleted,
	)
	return i, err
}

const listTemplates = `-- name: ListTemplates :many
SELECT DISTINCT ON (pt.project_id, pt.name) id, project_id, history_id, predecessor_id, name, description, arguments, prompt, engine, kind, tools_hint, created_at, updated_at, deleted_at, deleted
FROM prompt_templates pt
WHERE pt.project_id = $1
  AND pt.deleted IS FALSE
ORDER BY pt.project_id, pt.name, pt.id
`

func (q *Queries) ListTemplates(ctx context.Context, projectID uuid.UUID) ([]PromptTemplate, error) {
	rows, err := q.db.Query(ctx, listTemplates, projectID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PromptTemplate
	for rows.Next() {
		var i PromptTemplate
		if err := rows.Scan(
			&i.ID,
			&i.ProjectID,
			&i.HistoryID,
			&i.PredecessorID,
			&i.Name,
			&i.Description,
			&i.Arguments,
			&i.Prompt,
			&i.Engine,
			&i.Kind,
			&i.ToolsHint,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.DeletedAt,
			&i.Deleted,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const peekTemplateByID = `-- name: PeekTemplateByID :one
SELECT id, history_id
FROM prompt_templates
WHERE project_id = $1
  AND id = $2
  AND deleted IS FALSE
ORDER BY id DESC
LIMIT 1
`

type PeekTemplateByIDParams struct {
	ProjectID uuid.UUID
	ID        uuid.UUID
}

type PeekTemplateByIDRow struct {
	ID        uuid.UUID
	HistoryID uuid.UUID
}

func (q *Queries) PeekTemplateByID(ctx context.Context, arg PeekTemplateByIDParams) (PeekTemplateByIDRow, error) {
	row := q.db.QueryRow(ctx, peekTemplateByID, arg.ProjectID, arg.ID)
	var i PeekTemplateByIDRow
	err := row.Scan(&i.ID, &i.HistoryID)
	return i, err
}

const peekTemplatesByNames = `-- name: PeekTemplatesByNames :many
SELECT DISTINCT ON (pt.project_id, pt.name) pt.id, pt.history_id
FROM prompt_templates pt
WHERE pt.project_id = $1
  AND pt.name = ANY($2::TEXT[])
  AND pt.deleted IS FALSE
ORDER BY pt.project_id, pt.name, pt.id DESC
`

type PeekTemplatesByNamesParams struct {
	ProjectID uuid.UUID
	Names     []string
}

type PeekTemplatesByNamesRow struct {
	ID        uuid.UUID
	HistoryID uuid.UUID
}

func (q *Queries) PeekTemplatesByNames(ctx context.Context, arg PeekTemplatesByNamesParams) ([]PeekTemplatesByNamesRow, error) {
	rows, err := q.db.Query(ctx, peekTemplatesByNames, arg.ProjectID, arg.Names)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []PeekTemplatesByNamesRow
	for rows.Next() {
		var i PeekTemplatesByNamesRow
		if err := rows.Scan(&i.ID, &i.HistoryID); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}
